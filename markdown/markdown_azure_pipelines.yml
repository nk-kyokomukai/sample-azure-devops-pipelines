variables:
  buildProgramFilePath: 'markdown/build_program'
  buildProgramFileName: 'md-to-html.js'
  targetMarkdownRelativePath: '../sample'

trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

steps:

- script: |
    'cd $(buildProgramFilePath)'
    'yarn add crossnote'
  displayName: 'crossnote install'

- script: |
    'sudo apt update'
    'sudo apt install -y libtool graphviz'
  displayName: 'Graphviz install'

- script: |
    'cd $(buildProgramFilePath)'
    'node $(buildProgramFileName) $(targetMarkdownRelativePath).md'
  displayName: 'Markdown document build'

- task: CopyFiles@2
  inputs:
    Contents: '$(targetMarkdownRelativePath).html'
    TargetFolder: '$(Build.ArtifactStagingDirectory)/$(folderName)'
  displayName: 'Copy files'

# ビルド成果物をアップロードする
- task: publishBuildArtifacts@1
  displayName: 'Publish artifact'
