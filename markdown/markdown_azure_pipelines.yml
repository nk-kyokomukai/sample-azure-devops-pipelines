trigger:
- main

variables:
  buildProgramFilePath: 'markdown/build_program'
  buildProgramFileName: 'md-to-html.js'
  targetMarkdownRelativePath: '../sample'

jobs:
- job: HtmlBuild
  pool:
    vmImage: 'ubuntu-latest'
  steps:
    - script: |
        cd $(buildProgramFilePath)
        yarn add crossnote
      displayName: 'crossnote install'

    - script: |
        sudo apt update
        sudo apt install -y libtool graphviz
      displayName: 'graphviz install'

    - script: |
        brew install icu4c
        cd $(buildProgramFilePath)
        node $(buildProgramFileName) $(targetMarkdownRelativePath).md
        cp $(targetMarkdownRelativePath).html $(Build.ArtifactStagingDirectory)/
      displayName: 'markdown document build'

    - task: publishBuildArtifacts@1
      displayName: 'Publish Artifact: crossnote'